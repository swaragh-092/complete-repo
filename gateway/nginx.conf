# This for how much cores to be used 
worker_processes auto;


# events is how to act settings will come in this 
events {
    worker_connections 4096; # this is for how many connections will come here 
    multi_accept on; # this is for accepting multiple connections at once
    use epoll; # Linux kernel event notification system, to handle network connections efficiently.
}

http {

    sendfile on;          # faster static files
    keepalive_timeout 30; # reuse connections for 30 seconds


    # certificates 
    ssl_certificate /etc/nginx/certs/wildcard.fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/wildcard.privkey.pem;

    # Security settings
    ssl_protocols TLSv1.2 TLSv1.3;  # Only allow secure protocols
    ssl_ciphers HIGH:!aNULL:!MD5;   # Strong ciphers only
    
    # include mime.types; # Includes file defining MIME types (e.g., .html = text/html, .jpg = image/jpeg)
    include /etc/nginx/mime.types;

    default_type  application/octet-stream; # Default MIME type to use if none is detected (safe fallback is binary data)

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main; # Main access log for all incoming requests
    error_log /var/log/nginx/error.log warn; # Error log for tracking server-side issues and misconfigurations

    log_format ratelimitlog '$remote_addr - $status - $request_time - $request_uri'; # Defines a custom log format named 'ratelimitlog' to log IP, status, response time, and URI
    access_log /var/log/nginx/rate_limit.log ratelimitlog; # Enables a separate access log file using the custom log format above (useful for rate limit diagnostics)

    gzip on;  # Enables GZIP compression for supported response types to improve performance
    gzip_types text/plain text/css application/json application/javascript; # Specifies which MIME types should be compressed with GZIP
    

    # Includes all configuration files ending in .conf from the /etc/nginx/conf.d directory
    # Typically where domain-specific reverse proxy settings live
    # include /etc/nginx/conf.d/*.conf;

    # Global configs
    include /etc/nginx/conf.d/global/*.conf;

    # Service registry
    include /etc/nginx/conf.d/upstreams.conf;

    # include all application servers
    include /etc/nginx/conf.d/services/*.conf;

    # Virtual hosts
    include /etc/nginx/conf.d/servers/*.conf;

}

